"use strict";function deinterleave(t,r){var e=t.length/256;if(r.length!=e)throw"not enough space in output arrays";for(var i=0;i<channelCount;i++){let s=r[i],o=i;for(var a=0;a<128;++a)s[a]=t[o],o+=e}}function interleave(t,r){if(128*t.length!=r.length)throw"input and output of incompatible sizes";for(var e=0,i=0;i<128;i++)for(;j<r.length;j++)r[e]=t[0][i],e++}globalThis.exports=globalThis.exports||{},Object.defineProperty(exports,"__esModule",{value:!0});class AudioWriter{constructor(t){if("Float32Array"!=t.type())throw"This class requires a ring buffer of Float32Array";this.ringbuf=t}enqueue(t){return this.ringbuf.push(t)}available_write(){return this.ringbuf.available_write()}}class AudioReader{constructor(t){if("Float32Array"!=t.type())throw"This class requires a ring buffer of Float32Array";this.ringbuf=t}dequeue(t){return this.ringbuf.empty()?0:this.ringbuf.pop(t)}available_read(){return this.ringbuf.available_read()}}class ParameterWriter{constructor(t){if("Uint8Array"!=t.type())throw"This class requires a ring buffer of Uint8Array";this.ringbuf=t,this.mem=new ArrayBuffer(5),this.array=new Uint8Array(this.mem),this.view=new DataView(this.mem)}enqueue_change(t,r){return this.view.setUint8(0,t),this.view.setFloat32(1,r),!(this.ringbuf.available_write()<5)&&5==this.ringbuf.push(this.array)}}class ParameterReader{constructor(t){this.ringbuf=t,this.mem=new ArrayBuffer(5),this.array=new Uint8Array(this.mem),this.view=new DataView(this.mem)}dequeue_change(t){if(this.ringbuf.empty())return!1;this.ringbuf.pop(this.array);return t.index=this.view.getUint8(0),t.value=this.view.getFloat32(1),!0}}class RingBuffer{static getStorageForCapacity(t,r){if(!r.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var e=8+(t+1)*r.BYTES_PER_ELEMENT;return new SharedArrayBuffer(e)}constructor(t,r){if(!ArrayBuffer.__proto__.isPrototypeOf(r)&&void 0!==r.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=r,this.capacity=(t.byteLength-8)/r.BYTES_PER_ELEMENT,this.buf=t,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new r(this.buf,8,this.capacity)}type(){return this._type.name}push(t){var r=Atomics.load(this.read_ptr,0),e=Atomics.load(this.write_ptr,0);if((e+1)%this._storage_capacity()==r)return 0;let i=Math.min(this._available_write(r,e),t.length),a=Math.min(this._storage_capacity()-e,i),s=i-a;return this._copy(t,0,this.storage,e,a),this._copy(t,a,this.storage,0,s),Atomics.store(this.write_ptr,0,(e+i)%this._storage_capacity()),i}pop(t){var r=Atomics.load(this.read_ptr,0),e=Atomics.load(this.write_ptr,0);if(e==r)return 0;let i=Math.min(this._available_read(r,e),t.length),a=Math.min(this._storage_capacity()-r,t.length),s=i-a;return this._copy(this.storage,r,t,0,a),this._copy(this.storage,0,t,a,s),Atomics.store(this.read_ptr,0,(r+i)%this._storage_capacity()),i}empty(){var t=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==t}full(){var t=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this.capacity!=t}capacity(){return this.capacity-1}available_read(){var t=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);return this._available_read(t,r)}available_write(){var t=Atomics.load(this.read_ptr,0),r=Atomics.load(this.write_ptr,0);return this._available_write(t,r)}_available_read(t,r){return r>t?r-t:r+this._storage_capacity()-t}_available_write(t,r){let e=t-r-1;return r>=t&&(e+=this._storage_capacity()),e}_storage_capacity(){return this.capacity}_copy(t,r,e,i,a){for(var s=0;s<a;s++)e[i+s]=t[r+s]}}exports.AudioReader=AudioReader,exports.AudioWriter=AudioWriter,exports.ParameterReader=ParameterReader,exports.ParameterWriter=ParameterWriter,exports.RingBuffer=RingBuffer,exports.deinterleave=deinterleave,exports.interleave=interleave;